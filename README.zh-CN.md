# KiroCLI Bot Gateway

Multi-platform bot gateway for Kiro CLI via ACP protocol.

## æ”¯æŒçš„å¹³å°

| å¹³å° | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| é£ä¹¦ | âœ… å¯ç”¨ | ç¾¤èŠï¼ˆ@æœºå™¨äººï¼‰å’Œç§èŠ |
| Discord | âœ… å¯ç”¨ | æœåŠ¡å™¨é¢‘é“ï¼ˆ@æœºå™¨äººï¼‰å’Œç§èŠ |

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Gateway                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚    é£ä¹¦     â”‚  â”‚   Discord   â”‚  â”‚   (æ›´å¤š)    â”‚   é€‚é…å™¨     â”‚
â”‚  â”‚   Adapter   â”‚  â”‚   Adapter   â”‚  â”‚             â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚         â”‚                â”‚                â”‚                      â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                          â–¼                                       â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚              â”‚      å¹³å°è·¯ç”±å™¨        â”‚                           â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                          â”‚                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚         â–¼                â–¼                â–¼                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  kiro-cli   â”‚  â”‚  kiro-cli   â”‚  â”‚  kiro-cli   â”‚  æ¯å¹³å°ç‹¬ç«‹   â”‚
â”‚  â”‚   (é£ä¹¦)    â”‚  â”‚  (discord)  â”‚  â”‚   (...)     â”‚  å®ä¾‹        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åŠŸèƒ½ç‰¹æ€§

- **ğŸ”Œ å¤šå¹³å°æ”¯æŒ**ï¼šä¸€ä¸ªç½‘å…³æœåŠ¡å¤šä¸ªèŠå¤©å¹³å°
- **ğŸ”’ å¹³å°éš”ç¦»**ï¼šæ¯ä¸ªå¹³å°ç‹¬ç«‹çš„ Kiro CLI å®ä¾‹
- **ğŸ“ çµæ´»çš„å·¥ä½œç©ºé—´æ¨¡å¼**ï¼š`per_chat`ï¼ˆç”¨æˆ·éš”ç¦»ï¼‰æˆ– `fixed`ï¼ˆå…±äº«é¡¹ç›®ï¼‰
- **ğŸ” äº¤äº’å¼æƒé™å®¡æ‰¹**ï¼šæ•æ„Ÿæ“ä½œéœ€ç”¨æˆ·ç¡®è®¤ï¼ˆy/n/tï¼‰
- **âš¡ æŒ‰éœ€å¯åŠ¨**ï¼šä»…åœ¨æ”¶åˆ°æ¶ˆæ¯æ—¶å¯åŠ¨ Kiro CLI
- **â±ï¸ ç©ºé—²è‡ªåŠ¨å…³é—­**ï¼šå¯é…ç½®çš„ç©ºé—²è¶…æ—¶
- **ğŸ›‘ å–æ¶ˆæ“ä½œ**ï¼šå‘é€ "cancel" ä¸­æ–­å½“å‰æ“ä½œ
- **ğŸ”§ MCP å’Œ Skills æ”¯æŒ**ï¼šå…¨å±€æˆ–é¡¹ç›®çº§é…ç½®

## å·¥ä½œç©ºé—´æ¨¡å¼ï¼ˆé‡è¦ï¼ï¼‰

è¿™æ˜¯æœ€é‡è¦çš„é…ç½®ï¼Œè¯·ä»”ç»†ç†è§£ï¼š

### `per_chat` æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œæ¨èå¤šç”¨æˆ·åœºæ™¯ï¼‰

```
ç”¨æˆ· A â”€â”€â†’ ä¼šè¯ A â”€â”€â†’ /workspace/chat_id_A/
ç”¨æˆ· B â”€â”€â†’ ä¼šè¯ B â”€â”€â†’ /workspace/chat_id_B/
ç”¨æˆ· C â”€â”€â†’ ä¼šè¯ C â”€â”€â†’ /workspace/chat_id_C/
```

- æ¯ä¸ªç”¨æˆ·è·å¾—**ç‹¬ç«‹çš„å­ç›®å½•**
- ç”¨æˆ·ä¹‹é—´æ— æ³•çœ‹åˆ°æˆ–ä¿®æ”¹å½¼æ­¤çš„æ–‡ä»¶
- Kiro CLI åŠ è½½**å…¨å±€** `~/.kiro/` é…ç½®
- é€‚ç”¨äºï¼šå…¬å¼€æœºå™¨äººã€å¤šç”¨æˆ·åœºæ™¯

### `fixed` æ¨¡å¼ï¼ˆæ¨èé¡¹ç›®åä½œåœºæ™¯ï¼‰

```
ç”¨æˆ· A â”€â”€â†’ ä¼šè¯ A â”€â”€â”
ç”¨æˆ· B â”€â”€â†’ ä¼šè¯ B â”€â”€â”¼â”€â”€â†’ /path/to/project/
ç”¨æˆ· C â”€â”€â†’ ä¼šè¯ C â”€â”€â”˜
```

- æ‰€æœ‰ç”¨æˆ·å…±äº«**åŒä¸€ä¸ªç›®å½•**
- Kiro CLI åŠ è½½**é¡¹ç›®çº§** `.kiro/` é…ç½®
- é€‚ç”¨äºï¼šå›¢é˜Ÿåä½œã€ç‰¹å®šä»£ç åº“

### MCP å’Œ Skills é…ç½®ä½ç½®

| æ¨¡å¼ | é…ç½®ä½ç½® | ä½¿ç”¨åœºæ™¯ |
|------|----------|----------|
| `per_chat` | `~/.kiro/settings/mcp.json`<br>`~/.kiro/skills/` | æ‰€æœ‰ç”¨æˆ·å…±äº«çš„å·¥å…· |
| `fixed` | `{é¡¹ç›®}/.kiro/settings/mcp.json`<br>`{é¡¹ç›®}/.kiro/skills/` | é¡¹ç›®ä¸“ç”¨å·¥å…· |

### æŒ‰å¹³å°è¦†ç›–é…ç½®

ä¸åŒå¹³å°å¯ä»¥ä½¿ç”¨ä¸åŒæ¨¡å¼ï¼š

```bash
# å…¨å±€é»˜è®¤
KIRO_WORKSPACE_MODE=per_chat

# é’ˆå¯¹ç‰¹å®šå¹³å°è¦†ç›–
FEISHU_WORKSPACE_MODE=per_chat   # å…¬å¼€é£ä¹¦æœºå™¨äºº - éš”ç¦»ç”¨æˆ·
DISCORD_WORKSPACE_MODE=fixed     # å›¢é˜Ÿ Discord - å…±äº«é¡¹ç›®
```

## å‰ç½®è¦æ±‚

- Python 3.11+
- [kiro-cli](https://kiro.dev/docs/cli/) å·²å®‰è£…å¹¶ç™»å½•ï¼ˆ`kiro-cli auth login`ï¼‰
- å„å¹³å°çš„æœºå™¨äººå‡­è¯

## å®‰è£…

```bash
cd kirocli-bot-gateway
pip install -e .
```

## é…ç½®

```bash
cp .env.example .env
# ç¼–è¾‘ .env å¡«å…¥ä½ çš„é…ç½®
```

è¯¦ç»†é…ç½®é€‰é¡¹è¯·æŸ¥çœ‹ `.env.example` æ–‡ä»¶ä¸­çš„æ³¨é‡Šè¯´æ˜ã€‚

## å¹³å°é…ç½®

### é£ä¹¦

1. åœ¨[é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/app)åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨
   - ç‚¹å‡»**åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨**
   - å¡«å†™åº”ç”¨åç§°å’Œæè¿°

2. è·å–å‡­è¯ï¼šåœ¨**å‡­è¯ä¸åŸºç¡€ä¿¡æ¯**ä¸­ï¼Œå¤åˆ¶ **App ID**ï¼ˆæ ¼å¼ï¼š`cli_xxx`ï¼‰å’Œ **App Secret** åˆ° `.env` æ–‡ä»¶

3. æ·»åŠ "æœºå™¨äºº"èƒ½åŠ›ï¼šåœ¨**åº”ç”¨èƒ½åŠ›** > **æœºå™¨äºº**ä¸­å¯ç”¨æœºå™¨äºº â€” `.env` ä¸­çš„ `FEISHU_BOT_NAME` å¿…é¡»ä¸é£ä¹¦ä¸­æœºå™¨äººçš„æ˜¾ç¤ºåç§°ä¸€è‡´ï¼ˆé€šå¸¸ä¸åº”ç”¨åç§°ç›¸åŒï¼‰

4. é…ç½®æƒé™ï¼ˆå¯åœ¨é£ä¹¦å¼€æ”¾å¹³å°æƒé™é¡µé¢æ‰¹é‡å¯¼å…¥ï¼‰ï¼š
   - `im:message` - è¯»å†™æ¶ˆæ¯ï¼ˆåŸºç¡€æƒé™ï¼‰
   - `im:message:send_as_bot` - ä»¥æœºå™¨äººèº«ä»½å‘é€æ¶ˆæ¯
   - `im:message:readonly` - è¯»å–æ¶ˆæ¯å†å²
   - `im:message.group_at_msg:readonly` - æ¥æ”¶ç¾¤ @æ¶ˆæ¯
   - `im:message.p2p_msg:readonly` - æ¥æ”¶ç§èŠæ¶ˆæ¯
   - `im:chat.access_event.bot_p2p_chat:read` - ç§èŠäº‹ä»¶
   - `im:chat.members:bot_access` - æœºå™¨äººç¾¤æˆå‘˜è®¿é—®
   - `im:resource` - è®¿é—®æ¶ˆæ¯èµ„æºï¼ˆå›¾ç‰‡ã€æ–‡ä»¶ç­‰ï¼‰

   <details>
   <summary>æ‰¹é‡å¯¼å…¥ JSON</summary>

   ```json
   {
     "scopes": {
       "tenant": [
         "im:message",
         "im:message:send_as_bot",
         "im:message:readonly",
         "im:message.group_at_msg:readonly",
         "im:message.p2p_msg:readonly",
         "im:chat.access_event.bot_p2p_chat:read",
         "im:chat.members:bot_access",
         "im:resource"
       ],
       "user": []
     }
   }
   ```

   </details>

5. å…ˆå¯åŠ¨æœºå™¨äººï¼ˆä¿å­˜äº‹ä»¶è®¢é˜…éœ€è¦å…ˆå»ºç«‹è¿æ¥ï¼‰ï¼š
   ```bash
   python main.py
   ```
   æ­¤æ—¶æœºå™¨äººåªè¿æ¥é£ä¹¦ WebSocketï¼Œè¿˜ä¸ä¼šæ”¶åˆ°æ¶ˆæ¯ï¼Œä½†ä¸‹ä¸€æ­¥éœ€è¦è¿™ä¸ªè¿æ¥ã€‚

6. äº‹ä»¶è®¢é˜…ï¼šåœ¨**äº‹ä»¶è®¢é˜…**ä¸­ï¼Œé€‰æ‹©**ä½¿ç”¨é•¿è¿æ¥æ¥æ”¶äº‹ä»¶**ï¼ˆWebSocketï¼‰â€” æ— éœ€å…¬ç½‘ Webhook URL
   - æ·»åŠ äº‹ä»¶ï¼š`im.message.receive_v1`

7. å‘å¸ƒåº”ç”¨ï¼šåœ¨**ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ**ä¸­ï¼Œåˆ›å»ºç‰ˆæœ¬å¹¶å‘å¸ƒ
   - ä¼ä¸šè‡ªå»ºåº”ç”¨é€šå¸¸è‡ªåŠ¨å®¡æ‰¹
   - æƒé™å˜æ›´éœ€è¦å‘å¸ƒæ–°ç‰ˆæœ¬æ‰èƒ½ç”Ÿæ•ˆ

### Discord

1. åœ¨ [Discord å¼€å‘è€…é—¨æˆ·](https://discord.com/developers/applications) åˆ›å»ºåº”ç”¨
   - ç‚¹å‡» **New Application** å¹¶å‘½å

2. åˆ›å»ºæœºå™¨äººï¼š
   - è¿›å…¥ **Bot** æ ‡ç­¾é¡µ
   - ç‚¹å‡» **Add Bot**ï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
   - åœ¨ **Privileged Gateway Intents** ä¸‹å¯ç”¨ï¼š
     - **MESSAGE CONTENT INTENT**ï¼ˆå¿…é¡»ï¼Œç”¨äºè¯»å–æ¶ˆæ¯å†…å®¹ï¼‰
     - **SERVER MEMBERS INTENT**ï¼ˆæ¨èï¼Œç”¨äºæˆå‘˜æŸ¥æ‰¾å’Œç™½åå•åŒ¹é…ï¼‰
   - å¤åˆ¶ **Token** åˆ° `.env` æ–‡ä»¶çš„ `DISCORD_BOT_TOKEN`

3. ç”Ÿæˆé‚€è¯·é“¾æ¥ï¼š
   - è¿›å…¥ **OAuth2** > **URL Generator**
   - é€‰æ‹© scopesï¼š`bot`ã€`applications.commands`
   - é€‰æ‹© bot permissionsï¼š
     - View Channels
     - Send Messages
     - Send Messages in Threads
     - Embed Links
     - Attach Files
     - Read Message History
     - Add Reactions
   - å¤åˆ¶ç”Ÿæˆçš„ URLï¼Œæ‰“å¼€å®ƒé‚€è¯·æœºå™¨äººåˆ°ä½ çš„æœåŠ¡å™¨

4. é…ç½® `.env`ï¼š
   ```bash
   DISCORD_ENABLED=true
   DISCORD_BOT_TOKEN=your_token_here
   DISCORD_GUILD_ID=ä½ çš„æœåŠ¡å™¨ID        # å³é”®æœåŠ¡å™¨ â†’ å¤åˆ¶ ID
   DISCORD_ADMIN_USER_ID=ä½ çš„ç”¨æˆ·ID     # å³é”®è‡ªå·± â†’ å¤åˆ¶ ID
   DISCORD_REQUIRE_MENTION=true          # æ˜¯å¦éœ€è¦ @
   DISCORD_SLASH_COMMANDS=true           # å¯ç”¨ /help, /agent, /model
   ```

   > **å¤§å¤šæ•°ç”¨æˆ·åˆ°è¿™é‡Œå°±å¤Ÿäº†ï¼** æœºå™¨äººä¼šå…è®¸ä½ ç§èŠï¼Œå¹¶åœ¨ä½ çš„æœåŠ¡å™¨ä¸­å“åº”ã€‚
   > ä¸éœ€è¦é¢å¤–çš„é…ç½®æ–‡ä»¶ã€‚

5. **é«˜çº§ï¼šç»†ç²’åº¦è®¿é—®æ§åˆ¶**ï¼ˆå¯é€‰ï¼‰ï¼š
   
   å¦‚æœéœ€è¦æŒ‰æœåŠ¡å™¨ã€é¢‘é“ã€ç”¨æˆ·åˆ†åˆ«æ§åˆ¶ï¼Œåˆ›å»º `discord_policy.json`ï¼š
   ```bash
   cp discord_policy.example.json discord_policy.json
   # ç¼–è¾‘ discord_policy.jsonï¼Œå¡«å…¥ä½ çš„ ID
   ```

   å½“ `discord_policy.json` å­˜åœ¨æ—¶ï¼Œå®ƒä¼š**è¦†ç›–**ä¸Šé¢çš„ç¯å¢ƒå˜é‡è®¾ç½®ã€‚

   ç¤ºä¾‹ç­–ç•¥ï¼š
   ```json
   {
     "dm": {
       "enabled": true,
       "policy": "allowlist",
       "allowFrom": ["ä½ çš„ç”¨æˆ·ID"]
     },
     "groupPolicy": "allowlist",
     "guilds": {
       "*": {
         "requireMention": true
       },
       "ä½ çš„æœåŠ¡å™¨ID": {
         "requireMention": false,
         "users": ["ä½ çš„ç”¨æˆ·ID"],
         "channels": {
           "*": { "allow": true },
           "ç‰¹å®šé¢‘é“ID": {
             "allow": true,
             "requireMention": true,
             "users": ["ç”¨æˆ·ID_1", "ç”¨æˆ·ID_2"]
           }
         }
       }
     },
     "allowBots": false
   }
   ```

   **ç­–ç•¥é€‰é¡¹è¯´æ˜ï¼š**
   - `dm.enabled`ï¼šå¯ç”¨/ç¦ç”¨ç§èŠï¼ˆé»˜è®¤ï¼štrueï¼‰
   - `dm.policy`ï¼š`"allowlist"`ï¼ˆä»…ç™½åå•ç”¨æˆ·ï¼‰| `"open"`ï¼ˆä»»ä½•äººï¼‰| `"disabled"`ï¼ˆç¦ç”¨ï¼‰
   - `dm.allowFrom`ï¼šå…è®¸ç§èŠçš„ç”¨æˆ· ID åˆ—è¡¨
   - `groupPolicy`ï¼š`"allowlist"`ï¼ˆä»…ç™½åå•æœåŠ¡å™¨/é¢‘é“ï¼‰| `"open"` | `"disabled"`
   - `guilds.<id>.users`ï¼šæ¯ä¸ªæœåŠ¡å™¨çš„ç”¨æˆ·ç™½åå•ï¼ˆç©º = ä»»ä½•äººï¼‰
   - `guilds.<id>.channels.<id>.allow`ï¼šå…è®¸ç‰¹å®šé¢‘é“
   - `guilds.<id>.channels.<id>.requireMention`ï¼šé¢‘é“çº§ @ è¦†ç›–
   - `guilds.<id>.channels.<id>.users`ï¼šé¢‘é“çº§ç”¨æˆ·ç™½åå•
   - `guilds.<id>.requireMention`ï¼šæ˜¯å¦éœ€è¦ @ï¼ˆé»˜è®¤ï¼štrueï¼‰
   - `guilds."*"`ï¼šæœªåˆ—å‡ºæœåŠ¡å™¨çš„é»˜è®¤è®¾ç½®
   - `allowBots`ï¼šæ˜¯å¦å“åº”å…¶ä»–æœºå™¨äººï¼ˆé»˜è®¤ï¼šfalseï¼‰

   **å¦‚ä½•è·å– IDï¼š**
   - å¯ç”¨å¼€å‘è€…æ¨¡å¼ï¼šDiscord è®¾ç½® â†’ é«˜çº§ â†’ å¼€å‘è€…æ¨¡å¼
   - å³é”®ç‚¹å‡»ç”¨æˆ·/æœåŠ¡å™¨/é¢‘é“ â†’ å¤åˆ¶ ID

   **è®¿é—®æ§åˆ¶ä¼˜å…ˆçº§ï¼š**
   1. `discord_policy.json`ï¼ˆå¦‚æœå­˜åœ¨ï¼‰â€” å®Œå…¨æ§åˆ¶
   2. `DISCORD_ADMIN_USER_ID`ï¼ˆå¦‚æœè®¾ç½®ï¼‰â€” ç®€å•ç™½åå•
   3. éƒ½æ²¡æœ‰ â€” ç§èŠç¦ç”¨ï¼ŒæœåŠ¡å™¨å¼€æ”¾ä½†éœ€è¦ @

6. å¯åŠ¨ç½‘å…³ï¼š
   ```bash
   python main.py
   ```

**ä½¿ç”¨æ–¹å¼ï¼š**
- **åœ¨æœåŠ¡å™¨é¢‘é“**ï¼š@æœºå™¨äºº è¿›è¡Œäº¤äº’ï¼ˆé™¤éè®¾ç½® `requireMention: false`ï¼‰
- **åœ¨ç§èŠ**ï¼šç›´æ¥å‘é€æ¶ˆæ¯ï¼ˆå¦‚æœç­–ç•¥å…è®¸ï¼‰

## è¿è¡Œ

```bash
python main.py
```

### ä½œä¸º systemd æœåŠ¡è¿è¡Œï¼ˆå¯é€‰ï¼‰

æ”¯æŒå´©æºƒè‡ªåŠ¨é‡å¯å’Œå¼€æœºè‡ªå¯ï¼š

```bash
# å¤åˆ¶å¹¶ç¼–è¾‘ service æ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºä½ çš„å®é™…è·¯å¾„
cp kiro-gateway.service.example kiro-gateway.service
# ç¼–è¾‘ kiro-gateway.serviceï¼Œå¡«å…¥ä½ çš„è·¯å¾„
sudo cp kiro-gateway.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable kiro-gateway
sudo systemctl start kiro-gateway

# æŸ¥çœ‹çŠ¶æ€ / æ—¥å¿—
sudo systemctl status kiro-gateway
journalctl -u kiro-gateway -f
```

> **âš ï¸ æ³¨æ„ï¼š** systemd ä¸ä¼šç»§æ‰¿ä½ çš„ shell ç¯å¢ƒå˜é‡ã€‚å¦‚æœ kiro-cli æˆ– MCP server
> ï¼ˆå¦‚åŸºäº npx çš„ï¼‰æŠ¥ "No such file or directory"ï¼Œéœ€è¦ç¼–è¾‘ `kiro-gateway.service`
> ä¸­çš„ `Environment=PATH=...`ï¼ŒåŠ å…¥ `kiro-cli`ã€`npx` ç­‰å·¥å…·çš„å®‰è£…è·¯å¾„
> ï¼ˆå¦‚ `~/.local/bin`ã€nvm çš„ `bin` ç›®å½•ï¼‰ã€‚

## ä½¿ç”¨æ–¹æ³•

### è§¦å‘æ–¹å¼

| å¹³å° | è§¦å‘æ–¹å¼ |
|------|----------|
| é£ä¹¦ç¾¤èŠ | @æœºå™¨äºº + æ¶ˆæ¯ |
| é£ä¹¦ç§èŠ | ç›´æ¥å‘é€æ¶ˆæ¯ |
| Discord æœåŠ¡å™¨ | @æœºå™¨äºº + æ¶ˆæ¯ |
| Discord ç§èŠ | ç›´æ¥å‘é€æ¶ˆæ¯ |

### æ–œæ å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/agent` | åˆ—å‡ºå¯ç”¨çš„ Agent |
| `/agent <åç§°>` | åˆ‡æ¢ Agent |
| `/model` | åˆ—å‡ºå¯ç”¨çš„æ¨¡å‹ |
| `/model <åç§°>` | åˆ‡æ¢æ¨¡å‹ |
| `/help` | æ˜¾ç¤ºå¸®åŠ© |

### å…¶ä»–å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `cancel` / `stop` | å–æ¶ˆå½“å‰æ“ä½œ |

### æƒé™å®¡æ‰¹

å½“ Kiro éœ€è¦æ‰§è¡Œæ•æ„Ÿæ“ä½œæ—¶ï¼š

```
ğŸ” Kiro è¯·æ±‚æƒé™ï¼š
ğŸ“‹ åˆ›å»ºæ–‡ä»¶ï¼šhello.txt
å›å¤ï¼šy(å…è®¸) / n(æ‹’ç») / t(ä¿¡ä»»)
â±ï¸ 60ç§’åè‡ªåŠ¨æ‹’ç»
```

- **y** / yes / ok - å…è®¸ä¸€æ¬¡
- **n** / no - æ‹’ç»
- **t** / trust / always - æœ¬ä¼šè¯å§‹ç»ˆå…è®¸æ­¤ç±»æ“ä½œ

## å›¾æ ‡è¯´æ˜

| å›¾æ ‡ | å«ä¹‰ |
|------|------|
| ğŸ“„ | è¯»å–æ–‡ä»¶ |
| ğŸ“ | ç¼–è¾‘æ–‡ä»¶ |
| âš¡ | æ‰§è¡Œå‘½ä»¤ |
| ğŸ”§ | å…¶ä»–å·¥å…· |
| âœ… | æˆåŠŸ |
| âŒ | å¤±è´¥ |
| â³ | è¿›è¡Œä¸­ |
| ğŸš« | å·²æ‹’ç» |
| ğŸ” | æƒé™è¯·æ±‚ |

## é¡¹ç›®ç»“æ„

```
kirocli-bot-gateway/
â”œâ”€â”€ main.py                        # å…¥å£
â”œâ”€â”€ gateway.py                     # æ ¸å¿ƒç½‘å…³é€»è¾‘
â”œâ”€â”€ config.py                      # é…ç½®ç®¡ç†
â”œâ”€â”€ acp_client.py                  # ACP åè®®å®¢æˆ·ç«¯
â”œâ”€â”€ .env.example                   # ç¯å¢ƒé…ç½®æ¨¡æ¿ï¼ˆå¤åˆ¶ä¸º .envï¼‰
â”œâ”€â”€ discord_policy.json            # Discord è®¿é—®ç­–ç•¥ï¼ˆå¯é€‰ï¼Œè¦†ç›–ç¯å¢ƒå˜é‡ï¼‰
â”œâ”€â”€ discord_policy.example.json    # Discord ç­–ç•¥ç¤ºä¾‹ï¼ˆå¤åˆ¶åç¼–è¾‘ï¼‰
â”œâ”€â”€ pyproject.toml                 # Python åŒ…é…ç½®
â”œâ”€â”€ kiro-gateway.service.example    # systemd æœåŠ¡æ¨¡æ¿ï¼ˆå¤åˆ¶åç¼–è¾‘ï¼‰
â””â”€â”€ adapters/
    â”œâ”€â”€ __init__.py                # åŒ…å¯¼å‡º
    â”œâ”€â”€ base.py                    # ChatAdapter æ¥å£
    â”œâ”€â”€ feishu.py                  # é£ä¹¦å®ç°
    â””â”€â”€ discord.py                 # Discord å®ç°
```

## æ·»åŠ æ–°å¹³å°

1. åˆ›å»º `adapters/yourplatform.py`
2. å®ç° `adapters/base.py` ä¸­çš„ `ChatAdapter` æ¥å£
3. åœ¨ `config.py` ä¸­æ·»åŠ é…ç½®
4. åœ¨ `main.py` ä¸­æ³¨å†Œé€‚é…å™¨
